%option 8bit reentrant bison-locations
%option never-interactive
%option noyywrap noinput nounput
%option prefix="_mp_equation_"
%option extra-type="MPEquationParserState *"
%option outfile="mp-equation-lexer.c" header-file="mp-equation-lexer.h"

%{
/*  Copyright (c) 2004-2008 Sami Pietila
 *  Copyright (c) 2008-2009 Robert Ancell
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2, or (at your option)
 *  any later version.
 *
 *  This program is distributed in the hope that it will be useful, but
 *  WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 *  General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
 *  02111-1307, USA.
 */

#include <stdlib.h>
#include <locale.h>
#include <string.h>
#include <sys/types.h>

#include "mp-equation-private.h"
#include "mp-equation-parser.h"
#include "mp-equation.h"
%}


ZERO          "0"|"Ù "|"Û°"|"ß€"|"à¥¦"|"à§¦"|"à©¦"|"à«¦"|"à­¦"|"à¯¦"|"à±¦"|"à³¦"|"àµ¦"|"à¹"|"à»"|"à¼ "|"á€"|"á‚"|"áŸ "|"á "|"á¥†"|"á§"|"á­"|"á®°"|"á±€"|"á±"|"ê˜ "|"ê£"|"ê¤€"|"ê©"|"ð’ "
ONE           "1"|"Ù¡"|"Û±"|"ß"|"à¥§"|"à§§"|"à©§"|"à«§"|"à­§"|"à¯§"|"à±§"|"à³§"|"àµ§"|"à¹‘"|"à»‘"|"à¼¡"|"á"|"á‚‘"|"áŸ¡"|"á ‘"|"á¥‡"|"á§‘"|"á­‘"|"á®±"|"á±"|"á±‘"|"ê˜¡"|"ê£‘"|"ê¤"|"ê©‘"|"ð’¡"
TWO           "2"|"Ù¢"|"Û²"|"ß‚"|"à¥¨"|"à§¨"|"à©¨"|"à«¨"|"à­¨"|"à¯¨"|"à±¨"|"à³¨"|"àµ¨"|"à¹’"|"à»’"|"à¼¢"|"á‚"|"á‚’"|"áŸ¢"|"á ’"|"á¥ˆ"|"á§’"|"á­’"|"á®²"|"á±‚"|"á±’"|"ê˜¢"|"ê£’"|"ê¤‚"|"ê©’"|"ð’¢"
THREE         "3"|"Ù£"|"Û³"|"ßƒ"|"à¥©"|"à§©"|"à©©"|"à«©"|"à­©"|"à¯©"|"à±©"|"à³©"|"àµ©"|"à¹“"|"à»“"|"à¼£"|"áƒ"|"á‚“"|"áŸ£"|"á “"|"á¥‰"|"á§“"|"á­“"|"á®³"|"á±ƒ"|"á±“"|"ê˜£"|"ê£“"|"ê¤ƒ"|"ê©“"|"ð’£"
FOUR          "4"|"Ù¤"|"Û´"|"ß„"|"à¥ª"|"à§ª"|"à©ª"|"à«ª"|"à­ª"|"à¯ª"|"à±ª"|"à³ª"|"àµª"|"à¹”"|"à»”"|"à¼¤"|"á„"|"á‚”"|"áŸ¤"|"á ”"|"á¥Š"|"á§”"|"á­”"|"á®´"|"á±„"|"á±”"|"ê˜¤"|"ê£”"|"ê¤„"|"ê©”"|"ð’¤"
FIVE          "5"|"Ù¥"|"Ûµ"|"ß…"|"à¥«"|"à§«"|"à©«"|"à««"|"à­«"|"à¯«"|"à±«"|"à³«"|"àµ«"|"à¹•"|"à»•"|"à¼¥"|"á…"|"á‚•"|"áŸ¥"|"á •"|"á¥‹"|"á§•"|"á­•"|"á®µ"|"á±…"|"á±•"|"ê˜¥"|"ê£•"|"ê¤…"|"ê©•"|"ð’¥"
SIX           "6"|"Ù¦"|"Û¶"|"ß†"|"à¥¬"|"à§¬"|"à©¬"|"à«¬"|"à­¬"|"à¯¬"|"à±¬"|"à³¬"|"àµ¬"|"à¹–"|"à»–"|"à¼¦"|"á†"|"á‚–"|"áŸ¦"|"á –"|"á¥Œ"|"á§–"|"á­–"|"á®¶"|"á±†"|"á±–"|"ê˜¦"|"ê£–"|"ê¤†"|"ê©–"|"ð’¦"
SEVEN         "7"|"Ù§"|"Û·"|"ß‡"|"à¥­"|"à§­"|"à©­"|"à«­"|"à­­"|"à¯­"|"à±­"|"à³­"|"àµ­"|"à¹—"|"à»—"|"à¼§"|"á‡"|"á‚—"|"áŸ§"|"á —"|"á¥"|"á§—"|"á­—"|"á®·"|"á±‡"|"á±—"|"ê˜§"|"ê£—"|"ê¤‡"|"ê©—"|"ð’§"
EIGHT         "8"|"Ù¨"|"Û¸"|"ßˆ"|"à¥®"|"à§®"|"à©®"|"à«®"|"à­®"|"à¯®"|"à±®"|"à³®"|"àµ®"|"à¹˜"|"à»˜"|"à¼¨"|"áˆ"|"á‚˜"|"áŸ¨"|"á ˜"|"á¥Ž"|"á§˜"|"á­˜"|"á®¸"|"á±ˆ"|"á±˜"|"ê˜¨"|"ê£˜"|"ê¤ˆ"|"ê©˜"|"ð’¨"
NINE          "9"|"Ù©"|"Û¹"|"ß‰"|"à¥¯"|"à§¯"|"à©¯"|"à«¯"|"à­¯"|"à¯¯"|"à±¯"|"à³¯"|"àµ¯"|"à¹™"|"à»™"|"à¼©"|"á‰"|"á‚™"|"áŸ©"|"á ™"|"á¥"|"á§™"|"á­™"|"á®¹"|"á±‰"|"á±™"|"ê˜©"|"ê£™"|"ê¤‰"|"ê©™"|"ð’©"
DECIMAL	      "."|","
DEC           {ZERO}|{ONE}|{TWO}|{THREE}|{FOUR}|{FIVE}|{SIX}|{SEVEN}|{EIGHT}|{NINE}
HEX           {DEC}|[A-F]|[a-f]
SUPER_DIGITS  "â°"|"Â¹"|"Â²"|"Â³"|"â´"|"âµ"|"â¶"|"â·"|"â¸"|"â¹"
SUPER_MINUS   "â»"
SUB_DIGITS    "â‚€"|"â‚"|"â‚‚"|"â‚ƒ"|"â‚„"|"â‚…"|"â‚†"|"â‚‡"|"â‚ˆ"|"â‚‰"
FRACTION      "Â½"|"â…“"|"â…”"|"Â¼"|"Â¾"|"â…•"|"â…–"|"â…—"|"â…˜"|"â…™"|"â…š"|"â…›"|"â…œ"|"â…"|"â…ž"
GREEKS        "Î±"|"Î²"|"Î³"|"Î´"|"Îµ"|"Î¶"|"Î·"|"Î¸"|"Î¹"|"Îº"|"Î»"|"Î¼"|"Î½"|"Î¾"|"Î¿"|"Ï€"|"Ï"|"Ï‚"|"Ïƒ"|"Ï„"|"Ï…"|"Ï†"|"Ï‡"|"Ïˆ"|"Ï‰"
DEGREES       "Â°"
MINUTES       "'"
SECONDS       "\""
LETTERS       [a-zA-Z]|{GREEKS}

SUP_NUM  {SUPER_DIGITS}+
NSUP_NUM {SUPER_MINUS}{SUPER_DIGITS}+
SUB_NUM  {SUB_DIGITS}+
WORD     {LETTERS}+
DEC_NUM  {DEC}+|{DEC}*{DECIMAL}{DEC}+
DEF_NUM  {HEX}+|{HEX}*{DECIMAL}{HEX}+
BASE_NUM {HEX}+{SUB_NUM}|{HEX}*{DECIMAL}{HEX}+{SUB_NUM}
ANGLE_NUM {DEC_NUM}{DEGREES}|{DEC}+{DEGREES}{DEC_NUM}{MINUTES}|{DEC}+{DEGREES}{DEC}+{MINUTES}{DEC_NUM}{SECONDS}

NUMBER   {DEF_NUM}|{BASE_NUM}|{FRACTION}|{DEC}+{FRACTION}|{ANGLE_NUM}
VARIABLE {WORD}|{WORD}{SUB_NUM}|{GREEKS}

MOD  [mM][oO][dD]
AND  "âˆ§"|[aA][nN][dD]
OR   "âˆ¨"|[oO][rR]
XOR  "âŠ»"|"âŠ•"|[xX][oO][rR]
NOT  "Â¬"|"~"|[nN][oO][tT]
RE   "âƒ°â„œ"
IM   "â„‘"
IN   [iI][nN]

%%

"+"         {return tADD;}
"-"|"âˆ’"     {return tSUBTRACT;}
"*"|"Ã—"     {return tMULTIPLY;}
"/"|"âˆ•"|"Ã·" {return tDIVIDE;}
{MOD}       {return tMOD;}
"âŒŠ"         {return tLFLOOR;}
"âŒ‹"         {return tRFLOOR;}
"âŒˆ"         {return tLCEILING;}
"âŒ‰"         {return tRCEILING;}
"âˆš"         {return tROOT;}
"âˆ›"         {return tROOT3;}
"âˆœ"         {return tROOT4;}
{NOT}       {return tNOT;}
{AND}       {return tAND;}
{OR}        {return tOR;}
{XOR}       {return tXOR;}
{IN}        {return tIN;}
{NUMBER}    {if (mp_set_from_string(yytext, _mp_equation_get_extra(yyscanner)->options->base, &yylval->int_t) != 0) REJECT; return tNUMBER;}
{SUP_NUM}   {yylval->integer = super_atoi(yytext); return tSUPNUM;}
{NSUP_NUM}  {yylval->integer = super_atoi(yytext); return tNSUPNUM;}
{SUB_NUM}   {yylval->integer = sub_atoi(yytext); return tSUBNUM;}
{VARIABLE}  {\
    MPEquationParserState *state = _mp_equation_get_extra(yyscanner);\
    if (state->function_is_defined(state, yytext)) {\
        yylval->name = strdup(yytext);\
        return tFUNCTION;\
    }\
    else {\
        yylval->name = strdup(yytext);\
        return tVARIABLE;\
    }\
}
[ \r\t\n]
.           {return *yytext;}

%%
